<!DOCTYPE html>
<html>
<head>
  <title>EEG + rPPG Dashboard (Full Screen)</title>
  <style>
    body {
      margin: 0;
      background: #000;
      color: #fff;
      font-family: Arial;
      text-align: center;
      overflow: hidden;
    }

    video {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: 0;
    }

    canvas {
      width: 90%;
      height: 200px;
      background: rgba(0,0,0,0.05); /* 95% transparent */
      margin-top: 10px;
      border-radius: 10px;
      z-index: 1;
      position: relative;
    }

    #foreheadBox {
      position: absolute;
      border: 2px solid red;
      pointer-events: none;
      z-index: 2;
    }

    #combinedOutput {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 15px;
      color: white;
      background: rgba(0,0,0,0.3);
      padding: 5px 10px;
      border-radius: 5px;
      z-index: 3;
    }
  </style>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

<video id="camera" autoplay muted playsinline></video>
<div id="foreheadBox"></div>

<canvas id="rppgChart"></canvas>
<canvas id="eegChart"></canvas>

<div id="combinedOutput">Combined rPPG + EEG: 0 Hz</div>

<script>
/* -------------------------------
   CAMERA FULL SCREEN + rPPG
-------------------------------- */
const video = document.getElementById('camera');

navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" }})
.then(stream => video.srcObject = stream);

let rData = [];
let eegData = [];

const rppgCtx = document.getElementById('rppgChart').getContext('2d');
const rppgChart = new Chart(rppgCtx, {
  type: 'line',
  data: {
    labels: Array(300).fill(""),
    datasets: [{
      label: "rPPG Heart Signal",
      data: Array(300).fill(0),
      borderColor: "red",
      borderWidth: 2,
      pointRadius: 0
    }]
  },
  options: {
    animation: false,
    scales: { y: { min: -20, max: 20 } }
  }
});

const eegCtx = document.getElementById('eegChart').getContext('2d');
const eegChart = new Chart(eegCtx, {
  type: 'line',
  data: {
    labels: Array(300).fill(""),
    datasets: [{
      label: "EEG Signal",
      data: Array(300).fill(0),
      borderColor: "cyan",
      borderWidth: 2,
      pointRadius: 0
    }]
  },
  options: {
    animation: false,
    scales: { y: { min: -100, max: 100 } }
  }
});

// rPPG frame reader
setInterval(() => {
  if (!video.videoWidth) return;

  const w = video.videoWidth;
  const h = video.videoHeight;

  const foreheadW = w * 0.30;
  const foreheadH = h * 0.10;
  const foreheadX = w * 0.35;
  const foreheadY = h * 0.15;

  const box = document.getElementById("foreheadBox");
  const rect = video.getBoundingClientRect();
  const scaleX = rect.width / w;
  const scaleY = rect.height / h;
  box.style.left = (rect.left + foreheadX * scaleX) + "px";
  box.style.top  = (rect.top + foreheadY * scaleY) + "px";
  box.style.width  = foreheadW * scaleX + "px";
  box.style.height = foreheadH * scaleY + "px";

  const temp = document.createElement("canvas");
  temp.width = foreheadW;
  temp.height = foreheadH;
  const tctx = temp.getContext("2d");
  tctx.drawImage(video, foreheadX, foreheadY, foreheadW, foreheadH, 0, 0, foreheadW, foreheadH);

  const frame = tctx.getImageData(0, 0, foreheadW, foreheadH);
  let sum = 0, count = 0;

  for (let i = 0; i < frame.data.length; i += 4) {
    sum += frame.data[i]; // Red channel average
    count++;
  }

  const val = (sum / count) - 128;
  rData.push(val);
  if (rData.length > 300) rData.shift();

  rppgChart.data.datasets[0].data = rData;
  rppgChart.update();
}, 50);

// EEG mock signal
setInterval(() => {
  const newVal = Math.sin(Date.now() / 120) * 50;
  eegData.push(newVal);
  if (eegData.length > 300) eegData.shift();
  eegChart.data.datasets[0].data = eegData;
  eegChart.update();
}, 50);

// Combined output in Hertz (simple demo calculation)
setInterval(() => {
  const rppgFreq = Math.abs(rData[rData.length-1] || 0) / 10;
  const eegFreq = Math.abs(eegData[eegData.length-1] || 0) / 10;
  const combined = (rppgFreq + eegFreq).toFixed(2);
  document.getElementById("combinedOutput").textContent = "Combined rPPG + EEG: " + combined + " Hz";
}, 500);

</script>

</body>
</html>
