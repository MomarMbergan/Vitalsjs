<!DOCTYPE html>
<html>
<head>
  <title>SkyNet Biometric Dashboard</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">

  <style>
    :root{
      --bg:#000; --fg:#fff; --panel-bg:rgba(255,255,255,0.06); --accent:#39FF14;
      --panel-radius:10px;
      --thermal-blue:#1e5fff; --thermal-cyan:#00ffff; --thermal-yellow:#ffea00; --thermal-orange:#ff7a00; --thermal-red:#ff0033;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:Arial,Helvetica,sans-serif;overflow:hidden}

    #dashboardContainer{position:relative;width:100vw;height:100vh;overflow:hidden}

    #camera,#overlay{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;z-index:0}
    #overlay{z-index:1;pointer-events:none}

    #statusBadge{
      position:absolute;top:12px;left:50%;transform:translateX(-50%);z-index:6;
      background:rgba(0,0,0,0.55);color:var(--accent);padding:8px 20px;border-radius:8px;font-weight:800;
      border:1px solid rgba(57,255,20,0.6);text-shadow:0 0 6px rgba(57,255,20,0.7),0 0 10px rgba(57,255,20,0.4);
    }

    #flipCameraBtn{
      position:absolute;top:12px;right:12px;z-index:6;background:rgba(0,0,0,0.25);
      color:#00f;padding:8px 12px;border-radius:8px;font-weight:700;border:1px solid rgba(255,255,255,0.22);
      text-shadow: 0 0 6px #00f, 0 0 12px #0ff;
      animation: glow 1.5s infinite alternate;
      cursor:pointer;
    }
    @keyframes glow{0%{text-shadow:0 0 4px #00f,0 0 8px #0ff;}100%{text-shadow:0 0 12px #00f,0 0 24px #0ff;}}

    #togglePanel, #footerToggles{
      position:absolute;display:flex;flex-direction:column;gap:10px;z-index:6;
    }
    #togglePanel{top:50%;right:-64px;transform:translateY(-50%);transition:right 0.3s ease;}
    #togglePanel.open{ right:12px }
    #panelHandle{position:absolute;top:50%;right:0;transform:translateY(-50%);z-index:7;background:rgba(0,0,0,0.55);color:#fff;padding:8px 10px;border-radius:8px 0 0 8px;cursor:pointer;font-weight:800;user-select:none}
    
    .icon-btn{
      background:rgba(0,0,0,0.55);color:#fff;border-radius:8px;padding:8px;cursor:pointer;font-size:20px;border:1px solid rgba(255,255,255,0.22)
    }

    #footerToggles{bottom:12px;left:50%;transform:translateX(-50%);flex-direction:row;}
    
    #dashboardWrap{
      position:absolute;z-index:2;width:100%;height:calc(100vh - 110px);
      margin-top:64px;overflow-y:auto;pointer-events:auto;
    }
    .dashboard{display:grid;grid-template-columns:1fr;gap:10px;width:95%;max-width:1300px;margin:0 auto}
    .panel{background:var(--panel-bg);border-radius:var(--panel-radius);padding:10px;backdrop-filter:blur(2px)}
    .panel h3{margin:0 0 8px 0;font-weight:700;font-size:22px}
    canvas.chart{width:100%;height:240px;background:transparent;border-radius:var(--panel-radius)}

    .colorbar{
      width:100%;height:22px;margin-top:8px;border-radius:5px;
      background:linear-gradient(90deg,var(--thermal-blue),var(--thermal-cyan),var(--thermal-yellow),var(--thermal-orange),var(--thermal-red));
      box-shadow:0 0 12px rgba(255,255,255,0.15);
    }

    #fusionEq{margin-top:8px;text-align:center;font-size:20px}

    .sankey-link{fill:none;stroke-opacity:0.8}
    .sankey-node rect{fill-opacity:0.95}
    .sankey-label{fill:#fff;font-size:12px;pointer-events:none}
  </style>
</head>
<body>

<div id="dashboardContainer">
  <video id="camera" autoplay muted playsinline></video>
  <canvas id="overlay"></canvas>

  <div id="statusBadge">Analyzing</div>
  <button id="flipCameraBtn">Flip Camera</button>

  <div id="togglePanel">
    <button class="icon-btn" id="btnThermal" title="Toggle thermal view">üå°Ô∏è</button>
    <button class="icon-btn" id="btnEEG" title="Toggle EEG thermal">üß†</button>
    <button class="icon-btn" id="btnAnnotations" title="Toggle annotations">‚ú≥Ô∏è</button>
    <button class="icon-btn" id="btnSpectra" title="Toggle spectra">üìà</button>
    <button class="icon-btn" id="btnSnapshot" title="Capture snapshot">üì∏</button>
  </div>
  <div id="panelHandle" title="Open/close controls">‚Ä∫</div>

  <div id="footerToggles">
    <button class="icon-btn" id="toggleSmoothing" title="Toggle Smoothing">üéöÔ∏è</button>
    <button class="icon-btn" id="toggleFFT" title="Toggle FFT Window">ü™Ñ</button>
    <button class="icon-btn" id="toggleAmplitude" title="Toggle Amplitude">üîä</button>
  </div>

  <div id="dashboardWrap">
    <div class="dashboard">
      <div class="panel">
        <h3>Alluvial flow</h3>
        <svg id="alluvial" width="100%" height="220"></svg>
      </div>
      <div class="panel">
        <h3>Heart Rate</h3>
        <canvas id="rppgChart" class="chart"></canvas>
        <div class="colorbar"></div>
      </div>
      <div class="panel">
        <h3>EEG</h3>
        <canvas id="eegChart" class="chart"></canvas>
        <div class="colorbar"></div>
      </div>
      <div class="panel">
        <h3>rPPG FFT</h3>
        <canvas id="rppgFFT" class="chart"></canvas>
        <div class="colorbar"></div>
      </div>
      <div class="panel">
        <h3>Fusion</h3>
        <div id="fusionOutput">
          <div id="freqFusion">1. Frequency-Domain Fusion: 0 Hz</div>
          <div id="peakFusion">2. Peak-Based Fusion: 0 Hz</div>
          <div id="coherenceFusion">3. Cross-Spectral Coherence: 0</div>
        </div>
        <div id="fusionEq">
          $$F_{\text{fusion}}(f) = \text{FFT}_{\text{EEG}}(f) + \text{FFT}_{\text{rPPG}}(f) + \text{FFT}_{\text{HR}}(f)$$
        </div>
      </div>
      <div class="panel">
        <h3>CPU/GPU</h3>
        <canvas id="sysFlow" class="chart"></canvas>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/face-api.js"></script>

<script>
// ===== Camera =====
let facingMode = "user";
const video = document.getElementById('camera');

async function startCamera(){
  try{
    const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode},audio:false});
    video.srcObject = stream;
    await video.play();
  }catch(e){console.error(e);}
}
startCamera();
document.getElementById('flipCameraBtn').addEventListener('click', async ()=>{
  facingMode = (facingMode==='user')?'environment':'user';
  await startCamera();
});

// ===== Panel handle =====
const panelHandle=document.getElementById('panelHandle');
const togglePanel=document.getElementById('togglePanel');
panelHandle.addEventListener('click',()=>{ togglePanel.classList.toggle('open'); panelHandle.textContent=togglePanel.classList.contains('open')?'‚Äπ':'‚Ä∫'; });

// ===== Footer Toggles (now buttons like side panel) =====
document.getElementById('toggleSmoothing').addEventListener('click',()=>{ alert('Smoothing toggled!') });
document.getElementById('toggleFFT').addEventListener('click',()=>{ alert('FFT window toggled!') });
document.getElementById('toggleAmplitude').addEventListener('click',()=>{ alert('Amplitude toggled!') });

</script>
</body>
</html>
