<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Dual Camera Thermal Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="/js/pico.js"></script>
  <script src="/js/iploc.js"></script>
  <style>
    body { margin:0; background:black; font-family:Arial,sans-serif; }
    .container { display:flex; flex-direction:row; width:100vw; height:100vh; }
    .screen { position:relative; flex:1; overflow:hidden; }
    video, canvas.overlay { position:absolute; top:0; left:0; width:100%; height:100%; object-fit:cover; }
    .cameraControls { position:absolute; top:10px; left:10px; background:rgba(0,0,0,0.6); padding:10px; border-radius:8px; color:#00e5ff; z-index:30; }
    .cameraControls select, .cameraControls input { display:block; margin:6px 0; width:180px; padding:6px; border-radius:6px; border:none; background:rgba(255,255,255,0.1); color:#00e5ff; }
    .statusBlock { position:absolute; top:120px; left:10px; background:rgba(0,0,0,0.6); padding:8px 12px; border-radius:6px; font-size:0.9rem; color:#ff4081; z-index:25; }
    .analyzing { position:absolute; top:12px; left:50%; transform:translateX(-50%); font-size:1.2rem; color:#39ff14; text-shadow:0 0 8px #39ff14,0 0 14px #39ff14; z-index:40; }
    .hud { position:absolute; top:160px; left:10px; background:rgba(0,0,0,0.5); padding:10px 14px; border-radius:8px; color:#00e5ff; font-size:1rem; line-height:1.6; z-index:20; }
    .charts { position:absolute; bottom:0; left:0; width:100%; height:32%; display:flex; gap:20px; padding:12px 20px; background:rgba(0,0,0,0.4); z-index:15; }
    .chartBlock { flex:1; display:flex; flex-direction:column; }
    .chartLabel { color:#00e5ff; margin-bottom:6px; }
    .chartCanvas { width:100%; height:100%; background:transparent; }
    @media(max-width:768px){ .container{flex-direction:column;} .screen{height:50%;} }
  </style>
</head>
<body>
  <div class="container">
    <!-- FRONT CAMERA -->
    <div class="screen">
      <div class="analyzing">Analyzing</div>
      <div class="cameraControls">
        <label>Front Camera Source</label>
        <select id="frontSource" onchange="switchFrontCamera(this.value)">
          <option value="device">Device Camera</option>
          <option value="wifi">Wi‑Fi Camera</option>
        </select>
        <input id="frontIp" type="text" placeholder="Wi‑Fi IP"/>
        <input id="frontMac" type="text" placeholder="MAC Address"/>
      </div>
      <div id="frontStatus" class="statusBlock">Status: Not Connected</div>
      <video id="frontCam" autoplay playsinline muted></video>
      <canvas id="frontOverlay" class="overlay"></canvas>
      <div class="hud">
        HR: <span id="hrFront">--</span> bpm<br>
        SpO₂: <span id="spo2Front">--</span> %
      </div>
      <div class="charts">
        <div class="chartBlock"><div class="chartLabel">PPG Signal</div><canvas id="ppgFront" class="chartCanvas"></canvas></div>
        <div class="chartBlock"><div class="chartLabel">SpO₂ Signal</div><canvas id="spo2FrontChart" class="chartCanvas"></canvas></div>
      </div>
    </div>

    <!-- REAR CAMERA -->
    <div class="screen">
      <div class="analyzing">Analyzing</div>
      <div class="cameraControls">
        <label>Rear Camera Source</label>
        <select id="rearSource" onchange="switchRearCamera(this.value)">
          <option value="device">Device Camera</option>
          <option value="wifi">Wi‑Fi Camera</option>
        </select>
        <input id="rearIp" type="text" placeholder="Wi‑Fi IP"/>
        <input id="rearMac" type="text" placeholder="MAC Address"/>
      </div>
      <div id="rearStatus" class="statusBlock">Status: Not Connected</div>
      <video id="rearCam" autoplay playsinline muted></video>
      <canvas id="rearOverlay" class="overlay"></canvas>
      <div class="hud">
        HR: <span id="hrRear">--</span> bpm<br>
        SpO₂: <span id="spo2Rear">--</span> %
      </div>
      <div class="charts">
        <div class="chartBlock"><div class="chartLabel">PPG Signal</div><canvas id="ppgRear" class="chartCanvas"></canvas></div>
        <div class="chartBlock"><div class="chartLabel">SpO₂ Signal</div><canvas id="spo2RearChart" class="chartCanvas"></canvas></div>
      </div>
    </div>
  </div>

<script>
function setStatus(elId,text,ok){const el=document.getElementById(elId);el.textContent="Status: "+text;el.style.color=ok?"#00e676":"#ff4081";}

/* FRONT CAMERA SWITCH */
async function switchFrontCamera(source){
  const video=document.getElementById("frontCam");
  if(source==="device"){
    try{const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"},audio:false});
      video.srcObject=stream;setStatus("frontStatus","✅ Connected to Device Camera",true);}
    catch{setStatus("frontStatus","❌ Device Camera Access Denied",false);}
  } else {
    const ip=document.getElementById("frontIp").value.trim();
    const mac=document.getElementById("frontMac").value.trim();
    if(!ip) return setStatus("frontStatus","❌ Missing Wi‑Fi IP",false);
    video.srcObject=null;video.src=`http://${ip}/live.mp4?mac=${encodeURIComponent(mac)}`;
    video.play().then(()=>setStatus("frontStatus","✅ Connected to Wi‑Fi Camera",true))
                .catch(()=>setStatus("frontStatus","❌ Wi‑Fi Camera Unreachable",false));
  }
}

/* REAR CAMERA SWITCH */
async function switchRearCamera(source){
  const video=document.getElementById("rearCam");
  if(source==="device"){
    try{const stream=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"},audio:false});
      video.srcObject=stream;setStatus("rearStatus","✅ Connected to Device Camera",true);}
    catch{setStatus("rearStatus","❌ Device Camera Access Denied",false);}
  } else {
    const ip=document.getElementById("rearIp").value.trim();
    const mac=document.getElementById("rearMac").value.trim();
    if(!ip) return setStatus("rearStatus","❌ Missing Wi‑Fi IP",false);
    video.srcObject=null;video.src=`http://${ip}/live.mp4?mac=${encodeURIComponent(mac)}`;
    video.play().then(()=>setStatus("rearStatus","✅ Connected to Wi‑Fi Camera",true))
                .catch(()=>setStatus("rearStatus","❌ Wi‑Fi Camera Unreachable",false));
  }
}

/* AUTO ACTIVATE DEVICE CAMERAS ON LOAD */
window.addEventListener("load",()=>{switchFrontCamera("device");switchRearCamera("device");initCharts();startDemoSignals();});

/* THERMAL CHARTS */
let charts={};
function makeGradient(ctx,colors){const g=ctx.createLinearGradient(0,0,0,ctx.canvas.height);colors.forEach(([s,c])=>g.addColorStop(s,c));return g;}
function createChart(canvasId,colors){
  const ctx=document.getElementById(canvasId).getContext("2d");
  return new Chart(ctx,{type:"line",data:{labels:[],datasets:[{data:[],borderColor:makeGradient(ctx,colors),backgroundColor:"rgba(0,0,0,0.2)",fill:true,borderWidth:2.2,tension:0.35
