<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Biometric Studio</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&family=Rajdhani:wght@300;400;500;600;700&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            /* Neon Colors */
            --neon-cyan: #00ffff;
            --neon-magenta: #ff00ff;
            --neon-yellow: #ffff00;
            --neon-green: #00ff00;
            --neon-orange: #ff6600;
            --neon-pink: #ff1493;
            --neon-blue: #0080ff;
            --neon-purple: #9d00ff;
            --neon-red: #ff3366;
            
            /* Pearl White Tones */
            --pearl-white: #f8f8ff;
            --pearl-light: #ffffff;
            --pearl-dark: #e8e8f0;
            --pearl-shadow: #d8d8e8;
            
            /* Dark Background for Glow */
            --bg-dark: #0a0a0f;
            --bg-darker: #050508;
            --bg-panel: #12121a;
            --bg-elevated: #1a1a25;
        }

        body {
            font-family: 'Rajdhani', sans-serif;
            background: var(--bg-dark);
            color: var(--pearl-white);
            overflow: hidden;
            height: 100vh;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-darker) 100%);
        }

        /* Top Menu Bar */
        .menu-bar {
            height: 35px;
            background: var(--pearl-white);
            border-bottom: 2px solid var(--neon-cyan);
            display: flex;
            align-items: center;
            padding: 0 12px;
            gap: 15px;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);
            position: relative;
            z-index: 100;
        }

        .logo { font-family: 'Orbitron', sans-serif; font-weight: 900; font-size: 14px; background: linear-gradient(135deg, var(--neon-cyan), var(--neon-magenta)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-shadow: 0 0 20px rgba(0,255,255,0.5); margin-right: auto; }

        /* Main Content Area */
        .main-content { display: flex; flex: 1; overflow: hidden; }

        /* Center Area - Piano Roll & Tracks */
        .center-area { flex: 1; display: flex; flex-direction: column; background: var(--bg-panel); }

        /* Toolbar */
        .toolbar { height: 50px; background: var(--pearl-white); border-bottom: 2px solid var(--neon-green); display: flex; align-items: center; padding: 0 10px; gap: 6px; box-shadow: 0 0 20px rgba(0,255,0,0.3); overflow-x: auto; }

        /* Piano Roll - 60 Second Scrollable Timeline */
        .piano-roll { flex: 1; overflow: hidden; position: relative; background: var(--bg-panel); border-bottom: 2px solid var(--neon-purple); }

        /* Make piano column width controllable via CSS variable so it can collapse */
        .piano-roll-grid {
            display: grid;
            grid-template-columns: var(--piano-width, 80px) 1fr;
            background: var(--bg-darker);
            height: 100%;
            overflow: hidden;
            transition: grid-template-columns 220ms ease;
        }

        .piano-column { position: relative; }

        .piano-keys {
            background: var(--pearl-white);
            border-right: 2px solid var(--neon-purple);
            box-shadow: 0 0 20px rgba(157,0,255,0.3);
            overflow-y: auto;
            overflow-x: hidden;
            position: relative;
            z-index: 10;
            width: var(--piano-width, 80px);
            transition: width 220ms ease, opacity 220ms ease;
            min-width: 0;
        }

        .piano-key { height: 25px; border-bottom: 1px solid var(--pearl-shadow); display: flex; align-items: center; justify-content: center; padding: 0 10px; font-size: 11px; font-weight: 600; color: var(--bg-dark); cursor: pointer; }

        .note-grid { position: relative; height: 100%; overflow-x: auto; overflow-y: auto; background: var(--bg-darker); }

        .note-grid-content { position: relative; width: 6000px; min-height: 800px; background-image: repeating-linear-gradient(0deg, transparent, transparent 24px, var(--neon-purple) 24px, var(--neon-purple) 25px), repeating-linear-gradient(90deg, transparent, transparent 99px, rgba(0,255,255,0.2) 99px, rgba(0,255,255,0.2) 100px); background-size: 100% 25px, 100px 100%; }

        /* Timeline ruler */
        .timeline-ruler { position:absolute; top:0; left:0; width:100%; height:30px; background: rgba(0,0,0,0.9); border-bottom: 2px solid var(--neon-cyan); z-index:100; display:flex; font-family:'Orbitron',sans-serif; font-size:10px; color:var(--neon-cyan); font-weight:600; }
        .timeline-marker { width:100px; text-align:center; border-right:1px solid rgba(0,255,255,0.3); padding-top:8px; flex-shrink:0; }

        /* Waveform / Spectrum */
        .waveform-canvas, .spectrum-canvas { position:absolute; top:30px; left:0; width:100%; height:calc(100% - 30px); pointer-events:none; }

        /* Playhead */
        .playhead { position:absolute; top:0; left:0; width:3px; height:100%; z-index:50; pointer-events:none; background: linear-gradient(180deg, var(--neon-red), var(--neon-orange)); box-shadow:0 0 15px var(--neon-red); }

        /* Note */
        .note { position:absolute; height:23px; background:linear-gradient(135deg,var(--neon-cyan),var(--neon-blue)); border:2px solid var(--neon-cyan); border-radius:4px; cursor:move; box-shadow:0 0 15px var(--neon-cyan); }

        /* Collapse / Scroll controls for Piano & Mixer */
        .collapse-btn {
            position: absolute;
            left: -18px;
            top: 12px;
            width: 28px;
            height: 28px;
            border-radius: 6px;
            background: linear-gradient(135deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
            border: 2px solid rgba(255,255,255,0.06);
            color: var(--neon-cyan);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-family: 'Orbitron', sans-serif;
            font-size: 12px;
            box-shadow: 0 0 10px rgba(0,255,255,0.04);
            transition: transform 140ms ease, background 140ms ease;
            z-index: 120;
        }
        .collapse-btn:hover { transform: translateX(-2px); }
        .collapse-btn.collapsed { transform: rotate(180deg); }

        /* Collapsed piano */
        .piano-collapsed .piano-keys { width: 0 !important; opacity: 0; pointer-events: none; }

        /* Mixer container wrap so we can collapse vertically */
        .mixer-column { position: relative; }

        /* Ensure mixer channels horizontally scrollable (left-right) */
        .mixer-strip { overflow-x: auto; overflow-y: hidden; white-space: nowrap; -webkit-overflow-scrolling: touch; scrollbar-width: thin; height: 300px; background: var(--pearl-white); border-top:3px solid var(--neon-yellow); box-shadow:0 0 30px rgba(255,255,0,0.3); padding:10px; gap:8px; }
        .mixer-strip::-webkit-scrollbar { height: 10px; }
        .mixer-strip::-webkit-scrollbar-thumb { background: linear-gradient(90deg, var(--neon-cyan), var(--neon-magenta), var(--neon-yellow)); border-radius:5px; box-shadow:0 0 15px var(--neon-cyan); border:2px solid var(--pearl-white); }

        /* Keep channel cards non-shrinking so they scroll instead of wrap */
        .mixer-strip .channel { display: inline-flex; vertical-align: top; flex-direction: column; flex-shrink: 0; margin-right: 8px; min-width:115px; width:115px; }
        .mixer-strip .channel.master { min-width:130px; width:130px; }

        /* Collapsed mixer: shrink to a small bar (shows a handle) */
        .mixer-collapsed .mixer-strip { height: 40px !important; overflow: hidden; transition: height 220ms ease; }

        /* Mixer collapse button positioning */
        .mixer-column .collapse-btn { left: -18px; top: 12px; }

        /* Small responsive tweak */
        @media (max-width: 680px) { .collapse-btn { left: -22px; } }

        /* Mixer/channel base styles (kept largely from original) */
        .channel { background: linear-gradient(135deg, var(--pearl-light), var(--pearl-dark)); border: 2px solid var(--pearl-shadow); border-radius:8px; padding:8px 3px; gap:3px; transition: all 0.3s ease; }
        .channel:hover { border-color: var(--neon-cyan); box-shadow:0 0 20px var(--neon-cyan); transform: translateY(-3px); }
        .channel.master { background: linear-gradient(135deg,#ffffff,var(--pearl-light)); border:3px solid var(--neon-yellow); box-shadow:0 0 25px rgba(255,255,0,0.5); }
        .channel-header { display:flex; flex-direction:column; align-items:center; gap:3px; width:100%; }
        .channel-label { font-family:'Orbitron',sans-serif; font-weight:600; font-size:9px; color:var(--bg-dark); text-align:center; }
        .channel-number { font-family:'Orbitron',sans-serif; font-weight:700; font-size:11px; color:var(--pearl-white); background:var(--neon-cyan); padding:4px 10px; border-radius:4px; }

        /* basic fader/led styles retained for continuity */
        .vertical-fader { width:22px; height:60px; background:var(--pearl-dark); border-radius:10px; position:relative; border:2px solid var(--pearl-shadow); }
        .vertical-fader-fill { position:absolute; bottom:0; width:100%; background:linear-gradient(180deg, var(--neon-cyan), var(--neon-magenta)); border-radius:10px; }

    </style>
</head>
<body>

<div class="app-container">
    <div class="menu-bar">
        <div class="logo">VitalsJS</div>
        <div class="menu-item">File</div>
        <div class="menu-item">Edit</div>
        <div class="menu-item">View</div>
    </div>

    <div class="main-content">
        <!-- Left / Piano & Center Area -->
        <div class="center-area">
            <div class="toolbar">
                <div class="instrument-tabs">
                    <div class="instrument-tab active">Piano</div>
                    <div class="instrument-tab">Drums</div>
                    <div class="instrument-tab">Bass</div>
                    <div class="instrument-tab">Synth</div>
                </div>
                <button class="tool-btn play-btn" title="Play">▶</button>
                <div class="bpm-display">120 BPM</div>
            </div>

            <div class="piano-roll">
                <div class="piano-roll-grid">
                    <!-- Piano column wrapped for collapse button -->
                    <div class="piano-column">
                        <button class="collapse-btn" id="pianoToggle" aria-pressed="false" title="Collapse/Expand Piano column">◀</button>
                        <div class="piano-keys" id="pianoKeys">
                            <!-- simple piano key list -->
                            <div class="piano-key">C8</div>
                            <div class="piano-key black">B7</div>
                            <div class="piano-key">A7</div>
                            <div class="piano-key black">G#7</div>
                            <div class="piano-key">G7</div>
                            <div class="piano-key">F7</div>
                            <div class="piano-key black">E7</div>
                            <div class="piano-key">D7</div>
                            <div class="piano-key black">C#7</div>
                            <div class="piano-key">C7</div>
                            <!-- more keys as needed -->
                        </div>
                    </div>

                    <!-- Note grid / timeline -->
                    <div class="note-grid" id="noteGrid">
                        <div class="timeline-ruler" aria-hidden="true">
                            <!-- markers for 60 seconds at 100px per second -->
                            <!-- show 60 markers but keep a few for demo -->
                            <div class="timeline-marker">0s</div>
                            <div class="timeline-marker">1s</div>
                            <div class="timeline-marker">2s</div>
                            <div class="timeline-marker">3s</div>
                            <div class="timeline-marker">4s</div>
                            <div class="timeline-marker">5s</div>
                            <!-- ... -->
                        </div>

                        <canvas class="waveform-canvas"></canvas>
                        <canvas class="spectrum-canvas"></canvas>

                        <div class="note-grid-content">
                            <!-- Example note blocks -->
                            <div class="note" style="left:100px; top:40px; width:200px;"></div>
                            <div class="note" style="left:350px; top:80px; width:120px;"></div>
                        </div>

                        <div class="playhead" id="playhead"></div>
                    </div>
                </div>
            </div>

            <!-- Mixer (placed at bottom) -->
            <div class="mixer-column" id="mixerColumn">
                <button class="collapse-btn" id="mixerToggle" aria-pressed="false" title="Collapse/Expand Mixer">◀</button>
                <div class="mixer-strip" id="mixerStrip">
                    <!-- Channels 1..11 -->
                    <div class="channel" id="ch1">
                        <div class="channel-header"><div class="channel-number">1</div><div class="channel-label">Kick</div></div>
                        <div class="channel-content">
                            <div class="vertical-fader"><div class="vertical-fader-fill" style="height:60%"></div></div>
                        </div>
                    </div>
                    <div class="channel" id="ch2">
                        <div class="channel-header"><div class="channel-number">2</div><div class="channel-label">Snare</div></div>
                        <div class="channel-content"><div class="vertical-fader"><div class="vertical-fader-fill" style="height:50%"></div></div></div>
                    </div>
                    <div class="channel" id="ch3">
                        <div class="channel-header"><div class="channel-number">3</div><div class="channel-label">HiHat</div></div>
                        <div class="channel-content"><div class="vertical-fader"><div class="vertical-fader-fill" style="height:40%"></div></div></div>
                    </div>
                    <div class="channel" id="ch4">
                        <div class="channel-header"><div class="channel-number">4</div><div class="channel-label">Bass</div></div>
                        <div class="channel-content"><div class="vertical-fader"><div class="vertical-fader-fill" style="height:70%"></div></div></div>
                    </div>
                    <div class="channel" id="ch5">
                        <div class="channel-header"><div class="channel-number">5</div><div class="channel-label">Pad</div></div>
                        <div class="channel-content"><div class="vertical-fader"><div class="vertical-fader-fill" style="height:55%"></div></div></div>
                    </div>
                    <div class="channel" id="ch6">
                        <div class="channel-header"><div class="channel-number">6</div><div class="channel-label">Lead</div></div>
                        <div class="channel-content"><div class="vertical-fader"><div class="vertical-fader-fill" style="height:45%"></div></div></div>
                    </div>
                    <div class="channel" id="ch7">
                        <div class="channel-header"><div class="channel-number">7</div><div class="channel-label">FX1</div></div>
                        <div class="channel-content"><div class="vertical-fader"><div class="vertical-fader-fill" style="height:30%"></div></div></div>
                    </div>
                    <div class="channel" id="ch8">
                        <div class="channel-header"><div class="channel-number">8</div><div class="channel-label">FX2</div></div>
                        <div class="channel-content"><div class="vertical-fader"><div class="vertical-fader-fill" style="height:35%"></div></div></div>
                    </div>
                    <div class="channel" id="ch9">
                        <div class="channel-header"><div class="channel-number">9</div><div class="channel-label">Vox</div></div>
                        <div class="channel-content"><div class="vertical-fader"><div class="vertical-fader-fill" style="height:65%"></div></div></div>
                    </div>
                    <div class="channel" id="ch10">
                        <div class="channel-header"><div class="channel-number">10</div><div class="channel-label">Aux</div></div>
                        <div class="channel-content"><div class="vertical-fader"><div class="vertical-fader-fill" style="height:20%"></div></div></div>
                    </div>
                    <div class="channel" id="ch11">
                        <div class="channel-header"><div class="channel-number">11</div><div class="channel-label">Bus</div></div>
                        <div class="channel-content"><div class="vertical-fader"><div class="vertical-fader-fill" style="height:50%"></div></div></div>
                    </div>

                    <!-- Master channel (channel 12) -->
                    <div class="channel master" id="chMaster">
                        <div class="channel-header"><div class="channel-number">12</div><div class="channel-label">Master</div></div>
                        <div class="channel-content"><div class="vertical-fader"><div class="vertical-fader-fill" style="height:80%"></div></div></div>
                    </div>

                </div>
            </div>

        </div> <!-- end center-area -->

    </div> <!-- end main-content -->

</div> <!-- end app-container -->

<!-- Toggle script for piano & mixer collapse -->
<script>
(function () {
    const body = document.body;
    const pianoToggle = document.getElementById('pianoToggle');
    const mixerToggle = document.getElementById('mixerToggle');
    const pianoClass = 'piano-collapsed';
    const mixerClass = 'mixer-collapsed';

    function applyInitialState() {
        const pianoCollapsed = localStorage.getItem('vitalsjs.pianoCollapsed') === '1';
        const mixerCollapsed = localStorage.getItem('vitalsjs.mixerCollapsed') === '1';

        if (pianoCollapsed) {
            body.classList.add(pianoClass);
            document.documentElement.style.setProperty('--piano-width', '0px');
            if (pianoToggle) { pianoToggle.classList.add('collapsed'); pianoToggle.setAttribute('aria-pressed','true'); pianoToggle.textContent = '▶'; }
        }

        if (mixerCollapsed) {
            body.classList.add(mixerClass);
            if (mixerToggle) { mixerToggle.classList.add('collapsed'); mixerToggle.setAttribute('aria-pressed','true'); mixerToggle.textContent = '▶'; }
        }
    }

    if (pianoToggle) {
        pianoToggle.addEventListener('click', function () {
            const collapsed = document.body.classList.toggle(pianoClass);
            pianoToggle.classList.toggle('collapsed', collapsed);
            pianoToggle.setAttribute('aria-pressed', collapsed ? 'true' : 'false');
            pianoToggle.textContent = collapsed ? '▶' : '◀';
            if (collapsed) {
                document.documentElement.style.setProperty('--piano-width', '0px');
                localStorage.setItem('vitalsjs.pianoCollapsed', '1');
            } else {
                document.documentElement.style.removeProperty('--piano-width');
                localStorage.setItem('vitalsjs.pianoCollapsed', '0');
            }
        });
    }

    if (mixerToggle) {
        mixerToggle.addEventListener('click', function () {
            const collapsed = document.body.classList.toggle(mixerClass);
            mixerToggle.classList.toggle('collapsed', collapsed);
            mixerToggle.setAttribute('aria-pressed', collapsed ? 'true' : 'false');
            mixerToggle.textContent = collapsed ? '▶' : '◀';
            localStorage.setItem('vitalsjs.mixerCollapsed', collapsed ? '1' : '0');
        });
    }

    // Apply initial state on load
    applyInitialState();

})();
</script>

</body>
</html>